<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>SmartSeat — Library Seat Map</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="style.css">
  <style>
    body { background:#f5f8fb;font-family:"Segoe UI",Roboto,sans-serif; }

    .seat-grid {
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(70px,1fr));
      gap:10px;margin-top:12px;
    }

    .seat {
      display:flex;align-items:center;justify-content:center;
      background:#efefef;border:1px solid #ddd;border-radius:6px;
      padding:16px 0;font-weight:500;cursor:pointer;transition:.2s;
    }
    .seat:hover { background:#e0ebff; }
    .seat.selected { background:#34A853;color:white; }
    .seat.occupied { background:#ea4335;color:white;cursor:not-allowed; }

    .floor-tabs { display:flex;gap:10px;margin-top:10px; }
    .floor-tabs button {
      flex:1;padding:10px;border-radius:8px;border:0;background:#e6ebf7;cursor:pointer;font-weight:500;
    }
    .floor-tabs button.active { background:#0b69ff;color:white; }

    .modal {
      display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.4);
      justify-content:center;align-items:center;z-index:1000;
    }
    .modal-content {
      background:#fff;border-radius:12px;padding:22px;width:420px;
      max-height:80vh;overflow-y:auto;box-shadow:0 4px 20px rgba(0,0,0,.25);
    }
    .close-btn { float:right;font-weight:bold;color:#666;cursor:pointer; }
    .close-btn:hover { color:#000; }
  </style>
</head>

<body>

<header class="navbar">
  <div class="brand">
    <div class="logo">SS</div>
    <div style="font-weight:600">SmartSeat</div>
  </div>
  <div class="nav-right">
    <a href="venue.html">Back</a>
    <a href="profile.html">Profile</a>
  </div>
</header>

<div class="container">

  <div class="grid">

    <main>
      <div class="card">
        <h2>Library — Quiet Study Area</h2>
        <p class="small">Select a seat on your preferred floor.</p>

        <div class="floor-tabs">
          <button id="floor1Btn" class="active" onclick="switchFloor(1)">1st Floor</button>
          <button id="floor2Btn" onclick="switchFloor(2)">2nd Floor</button>
        </div>

        <div class="legend" style="margin-top:12px">
          <div><span class="dot" style="background:#efefef;border:1px solid #ddd;width:14px;height:14px"></span> Available</div>
          <div><span class="dot" style="background:#ea4335;width:14px;height:14px"></span> Occupied</div>
          <div><span class="dot" style="background:#34A853;width:14px;height:14px"></span> Selected</div>
          <div><span class="dot" style="background:#F6C85F;width:14px;height:14px"></span> Reserved</div>
        </div>

        <div id="seatGrid" class="seat-grid"></div>

        <div style="margin-top:18px;text-align:right">
          <button id="confirmBtn" disabled style="padding:10px 16px;border-radius:8px;background:#0b69ff;color:white;border:none;opacity:.6">Confirm Reservation</button>
        </div>
      </div>
    </main>

    <aside class="side-panel">
      <div class="card">
        <h3>Seat Info</h3>
        <div id="selected-info"><p class="small">No selection yet</p></div>
        <div class="meta-row" style="margin-top:12px"><span>Floor</span><strong id="floorLabel">1</strong></div>
        <div class="meta-row"><span>Hold time</span><strong>10 min</strong></div>

        <div style="margin-top:12px;text-align:right">
          <button id="viewDetailsBtn" class="gray" style="display:none" onclick="openModal()">View Details</button>
        </div>
      </div>

      <div class="card" style="margin-top:12px">
        <h4>Accessibility</h4>
        <p class="small">Accessible seats available on 1st Floor near entrance.</p>
      </div>
    </aside>

  </div>
</div>

<!-- Modal -->
<div class="modal" id="detailsModal">
  <div class="modal-content">
    <span class="close-btn" onclick="closeModal()">&times;</span>
    <h3>Seat Details</h3>
    <div id="modalDetail"></div>
  </div>
</div>

<script>
let currentFloor = 1;
let selectedSeat = null;

const seatGrid = document.getElementById('seatGrid');
const info = document.getElementById('selected-info');
const floorLabel = document.getElementById('floorLabel');
const confirmBtn = document.getElementById('confirmBtn');
const modal = document.getElementById("detailsModal");
const modalDetail = document.getElementById("modalDetail");
const viewBtn = document.getElementById("viewDetailsBtn");

function generateSeats(floor){
  seatGrid.innerHTML = "";

  const totalSeats = floor === 1 ? 48 : 36;
  const occupiedSeats = Array.from({length:8}, ()=>Math.floor(Math.random()*totalSeats)+1);

  for(let i=1;i<=totalSeats;i++){
    const seat=document.createElement("div");
    seat.className="seat";
    seat.textContent=i;

    if(occupiedSeats.includes(i)){
      seat.classList.add("occupied");
    } else {
      seat.addEventListener("click",()=>{
        document.querySelectorAll(".seat").forEach(s=>s.classList.remove("selected"));
        seat.classList.add("selected");

        selectedSeat={ id:i, floor, noise:["Quiet","Moderate","Busy"][i%3], power:Math.random()<.5?"Yes":"No", light:["Bright","Normal","Dim"][i%3] };

        info.innerHTML = `<p class="small">Selected seat: <strong>#${i}</strong> (Floor ${floor})</p>`;
        floorLabel.textContent = floor;
        viewBtn.style.display="inline-block";

        confirmBtn.disabled=false;
        confirmBtn.style.opacity=1;
      });
    }

    seatGrid.appendChild(seat);
  }
}

function switchFloor(floor){
  currentFloor=floor;
  document.getElementById("floor1Btn").classList.toggle("active",floor===1);
  document.getElementById("floor2Btn").classList.toggle("active",floor===2);
  generateSeats(floor);
  selectedSeat=null;
  info.innerHTML="<p class='small'>No selection yet</p>";
  confirmBtn.disabled=true;
  confirmBtn.style.opacity=.6;
  viewBtn.style.display="none";
}

function openModal(){
  if(!selectedSeat) return;

  modalDetail.innerHTML = `
    <p><strong>Seat:</strong> #${selectedSeat.id}</p>
    <p><strong>Floor:</strong> ${selectedSeat.floor}</p>
    <p><strong>Noise:</strong> ${selectedSeat.noise}</p>
    <p><strong>Power:</strong> ${selectedSeat.power}</p>
    <p><strong>Lighting:</strong> ${selectedSeat.light}</p>
  `;

  modal.style.display="flex";
}

function closeModal(){ modal.style.display="none"; }

confirmBtn.addEventListener("click",()=>{
  if(!selectedSeat) return;

  const record = {
    venue:"Library",
    seat:`Floor ${selectedSeat.floor} — #${selectedSeat.id}`,
    time:new Date().toLocaleString()
  };

  const list = JSON.parse(localStorage.getItem("reservations")||"[]");
  list.push(record);
  localStorage.setItem("reservations",JSON.stringify(list));

  alert(`Seat #${selectedSeat.id} on Floor ${selectedSeat.floor} confirmed.`);
  window.location.href="seatdetail.html";
});

generateSeats(1);
</script>

</body>
</html>
